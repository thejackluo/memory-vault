<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Graph - Interactive Memory Visualization</title>
    <link rel="stylesheet" href="memory-graph.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="welcome-screen">
        <div class="welcome-content">
            <h1 class="welcome-title">Memory Graph</h1>
            <p class="welcome-subtitle">Transform your conversations into an interactive knowledge graph</p>
            
            <div class="feature-cards">
                <div class="feature-card">
                    <div class="feature-icon">üë•</div>
                    <h3>People</h3>
                    <p>Discover people you've talked about</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üöÄ</div>
                    <h3>Projects</h3>
                    <p>Track your projects and ideas</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üí°</div>
                    <h3>Knowledge</h3>
                    <p>See what you've learned</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ùì</div>
                    <h3>Questions</h3>
                    <p>Explore questions you've asked</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üí≠</div>
                    <h3>Thoughts</h3>
                    <p>Capture your ideas and reflections</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîó</div>
                    <h3>Patterns</h3>
                    <p>Find recurring themes</p>
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h3 style="margin: 0 0 1rem 0; color: rgba(255,255,255,0.95); font-size: 1rem;">Processing Mode</h3>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="process-mode" value="incremental" checked style="margin-right: 0.5rem;" />
                            <span style="color: rgba(255,255,255,0.9);">Continue from last (Incremental)</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="process-mode" value="range" style="margin-right: 0.5rem;" />
                            <span style="color: rgba(255,255,255,0.9);">Custom Range</span>
                        </label>
                    </div>

                    <div id="incremental-controls" style="display: block;">
                        <label style="display: block; color: rgba(255,255,255,0.9); margin-bottom: 0.5rem; font-size: 0.875rem;">
                            Number of conversations to process:
                        </label>
                        <input 
                            type="number" 
                            id="process-count" 
                            value="50" 
                            min="1" 
                            step="50"
                            style="width: 200px; padding: 0.5rem; border-radius: 6px; border: none; font-size: 1rem; text-align: center;"
                        />
                        <p style="color: rgba(255,255,255,0.7); font-size: 0.75rem; margin-top: 0.5rem;">
                            Start with 50 to test, then increase or process in chunks of 100-500
                        </p>
                    </div>

                    <div id="range-controls" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="display: block; color: rgba(255,255,255,0.9); margin-bottom: 0.5rem; font-size: 0.875rem;">
                                    Start Index (0-based):
                                </label>
                                <input 
                                    type="number" 
                                    id="range-start" 
                                    value="0" 
                                    min="0"
                                    style="width: 100%; padding: 0.5rem; border-radius: 6px; border: none; font-size: 1rem;"
                                />
                            </div>
                            <div>
                                <label style="display: block; color: rgba(255,255,255,0.9); margin-bottom: 0.5rem; font-size: 0.875rem;">
                                    End Index:
                                </label>
                                <input 
                                    type="number" 
                                    id="range-end" 
                                    value="50" 
                                    min="1"
                                    style="width: 100%; padding: 0.5rem; border-radius: 6px; border: none; font-size: 1rem;"
                                />
                            </div>
                        </div>
                        <p style="color: rgba(255,255,255,0.7); font-size: 0.75rem; margin-top: 0.5rem;">
                            Process specific conversations (e.g., 0-50, 50-100, 100-500, etc.)
                        </p>
                    </div>
                </div>
            </div>
            
            <button id="start-processing" class="start-button">Process Conversations</button>
            <button id="view-history" class="start-button" style="background: rgba(59, 130, 246, 0.8); margin-left: 1rem;">View Processing History</button>
            <p class="welcome-note" id="progress-note">This will analyze conversations.json in the same directory</p>
        </div>
    </div>

    <!-- Processing Screen -->
    <div id="processing-screen" class="processing-screen" style="display: none;">
        <div class="processing-content">
            <h2 class="processing-title">Building Your Memory Graph</h2>
            <div class="processing-animation">
                <div class="spinner"></div>
            </div>
            <div class="processing-stats">
                <div class="stat">
                    <div class="stat-value" id="processed-count">0</div>
                    <div class="stat-label">Conversations Processed</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="entities-found">0</div>
                    <div class="stat-label">Entities Discovered</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="progress-percent">0%</div>
                    <div class="stat-label">Progress</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p class="processing-status" id="processing-status">Initializing...</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="main-app" style="display: none;">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="app-title">
                <span class="app-logo">üß†</span>
                <span class="app-name">Memory Graph</span>
            </div>
            
            <div class="search-container">
                <input 
                    type="text" 
                    id="search-input" 
                    class="search-input" 
                    placeholder="Search entities..."
                    autocomplete="off"
                />
                <div id="search-suggestions" class="search-suggestions"></div>
            </div>
            
            <div class="top-bar-actions">
                <button id="view-timeline" class="icon-button" title="Timeline View">
                    <span>üìÖ</span>
                </button>
                <button id="view-list" class="icon-button" title="List View">
                    <span>üìã</span>
                </button>
                <button id="reset-view" class="icon-button" title="Reset View">
                    <span>üîÑ</span>
                </button>
                <button id="show-history" class="icon-button" title="Processing History">
                    <span>üìú</span>
                </button>
                <button id="show-stats" class="icon-button" title="Statistics">
                    <span>üìä</span>
                </button>
                <button id="show-settings" class="icon-button" title="Settings">
                    <span>‚öôÔ∏è</span>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="content-area">
            <!-- Left Sidebar -->
            <div class="left-sidebar">
                <div class="filter-section">
                    <h3 class="filter-title">Entity Types</h3>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="checkbox" id="filter-person" checked />
                            <span class="filter-dot" style="background-color: #3b82f6"></span>
                            <span class="filter-label">People</span>
                            <span class="filter-count" id="count-person">0</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" id="filter-project" checked />
                            <span class="filter-dot" style="background-color: #10b981"></span>
                            <span class="filter-label">Projects</span>
                            <span class="filter-count" id="count-project">0</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" id="filter-knowledge" checked />
                            <span class="filter-dot" style="background-color: #f59e0b"></span>
                            <span class="filter-label">Knowledge</span>
                            <span class="filter-count" id="count-knowledge">0</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" id="filter-question" checked />
                            <span class="filter-dot" style="background-color: #8b5cf6"></span>
                            <span class="filter-label">Questions</span>
                            <span class="filter-count" id="count-question">0</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" id="filter-thought" checked />
                            <span class="filter-dot" style="background-color: #ec4899"></span>
                            <span class="filter-label">Thoughts</span>
                            <span class="filter-count" id="count-thought">0</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" id="filter-pattern" checked />
                            <span class="filter-dot" style="background-color: #06b6d4"></span>
                            <span class="filter-label">Patterns</span>
                            <span class="filter-count" id="count-pattern">0</span>
                        </label>
                    </div>
                </div>

                <div class="search-results-section" id="search-results-section" style="display: none;">
                    <h3 class="filter-title">Search Results</h3>
                    <div id="search-results" class="search-results"></div>
                </div>

                <div class="bookmarks-section">
                    <h3 class="filter-title">Bookmarks</h3>
                    <div id="bookmarks-list" class="bookmarks-list">
                        <div class="empty-state">No bookmarks yet</div>
                    </div>
                </div>
            </div>

            <!-- Center Area (Graph Canvas) -->
            <div class="center-area">
                <div class="breadcrumb" id="breadcrumb">
                    <span class="breadcrumb-item active">Overview</span>
                </div>
                
                <canvas id="graph-canvas"></canvas>
                
                <div class="graph-controls">
                    <button id="zoom-in" class="control-button" title="Zoom In">+</button>
                    <button id="zoom-out" class="control-button" title="Zoom Out">‚àí</button>
                    <button id="fit-view" class="control-button" title="Fit to Screen">‚ä°</button>
                </div>

                <div class="graph-legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background-color: #3b82f6"></div>
                        <span>Person</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background-color: #10b981"></div>
                        <span>Project</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background-color: #f59e0b"></div>
                        <span>Knowledge</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background-color: #8b5cf6"></div>
                        <span>Question</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background-color: #ec4899"></div>
                        <span>Thought</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background-color: #06b6d4"></div>
                        <span>Pattern</span>
                    </div>
                </div>
            </div>

            <!-- Right Panel (Entity Details / Timeline) -->
            <div class="right-panel" id="right-panel">
                <!-- Entity Panel will be injected here -->
            </div>
        </div>

        <!-- Timeline View (toggleable) -->
        <div class="timeline-container" id="timeline-container" style="display: none;">
            <!-- Timeline will be rendered here -->
        </div>
    </div>

    <!-- Stats Modal -->
    <div id="stats-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Memory Graph Statistics</h2>
                <button class="modal-close" id="close-stats">‚úï</button>
            </div>
            <div class="modal-body" id="stats-content">
                <!-- Stats will be populated here -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="close-settings">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <h3>Data Management</h3>
                    <button id="export-data" class="setting-button">Export Memory Graph</button>
                    <button id="import-data" class="setting-button">Import Memory Graph</button>
                    <button id="process-new" class="setting-button">Continue Processing More Conversations</button>
                    <button id="reprocess-data" class="setting-button">Reset & Start From Conversation 1</button>
                    <button id="clear-data" class="setting-button danger">Clear All Data</button>
                </div>
                <div class="setting-group">
                    <h3>Entity Filtering</h3>
                    <label class="setting-option">
                        <span>Minimum occurrences for entities:</span>
                        <input type="number" id="setting-min-occurrences" value="2" min="1" max="10" style="width: 60px; margin-left: 10px;" />
                    </label>
                    <p style="font-size: 0.875rem; color: var(--gray-600); margin-top: 0.5rem;">
                        Higher values = denser graph with only frequently mentioned entities
                    </p>
                </div>
                <div class="setting-group">
                    <h3>Visualization</h3>
                    <label class="setting-option">
                        <input type="checkbox" id="setting-show-labels" checked />
                        <span>Always show labels</span>
                    </label>
                    <label class="setting-option">
                        <input type="checkbox" id="setting-animate" checked />
                        <span>Animate graph layout</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing History Modal -->
    <div id="history-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Processing History & Status</h2>
                <button class="modal-close" id="close-history">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="history-stats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;">
                    <!-- Stats will be populated here -->
                </div>

                <div id="conversation-status-viz" style="margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1rem;">Conversation Processing Status</h3>
                    <div id="status-timeline" style="background: var(--gray-50); border-radius: 8px; padding: 1rem; min-height: 100px;">
                        <!-- Visual timeline will be rendered here -->
                    </div>
                    <div style="display: flex; gap: 2rem; margin-top: 1rem; font-size: 0.875rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 20px; height: 20px; background: #10b981; border-radius: 4px;"></div>
                            <span>Processed</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 20px; height: 20px; background: var(--gray-300); border-radius: 4px;"></div>
                            <span>Not Processed</span>
                        </div>
                    </div>
                </div>

                <div id="history-log" style="margin-top: 2rem;">
                    <h3 style="margin-bottom: 1rem;">Processing Log</h3>
                    <div id="history-entries" style="max-height: 400px; overflow-y: auto;">
                        <!-- History entries will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load scripts -->
    <script src="db-manager.js"></script>
    <script src="memory-processor.js"></script>
    <script src="graph-renderer.js"></script>
    <script src="timeline-view.js"></script>
    <script src="entity-panel.js"></script>
    <script src="search-engine.js"></script>
    <script src="memory-graph-app.js"></script>
</body>
</html>

